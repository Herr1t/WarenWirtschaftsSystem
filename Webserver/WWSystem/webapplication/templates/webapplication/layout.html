{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Waren-Wirtschafts-System</title>
        <link rel="shortcut icon" type="image/png" href="{% static 'webapplication/favicon.png' %}">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" href="{% static 'webapplication/styles.css' %}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    </head>
    <body style="background-color: rgb(244, 245, 247);">
        <div>
            {% if user.is_authenticated %}
                Signed in as <strong>{{ user.username }}</strong>.
            {% else %}
                Not signed in.
            {% endif %}
            <img style="float: right; width: 88px; height: auto;" src="https://confluence.med.tu-dresden.de/download/attachments/74285475/ITKB?version=2&modificationDate=1559050749303&api=v2">
            <h1 style="float: center; padding-bottom: 8px;">Waren-Wirtschafts-System</h1>
        </div>
        <ul style="background-color: rgb(8, 71, 166); padding: 3px; border-top: solid 1px black; border-bottom: solid 1px black;" class="nav">
            {% if user.is_authenticated %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'lagerliste' %}">Lagerliste</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'lager_ohne' %}">Lagerliste ohne Investmittel</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'bestell_liste' %}">BestellListe</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'investmittel' %}">Investmittelplan</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'profile' user.id %}">Profil</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'logout' %}">Log Out</a>
                </li>
            {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'login' %}">Log In</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'register' %}">Register</a>
                </li>
            {% endif %}
        </ul>
        {% block body %}
        {% endblock %}
        <script>           
            function undo() {
                var rows = document.querySelectorAll('table tr')
                rows.forEach(function(row, index) {
                    row.style.display='';
                })
            }

            function today() {
                // Get the current date
                var currentDate = new Date();
                var currentYear = currentDate.getFullYear();
                var currentMonth = currentDate.getMonth();
                var currentDay = currentDate.getDate();
                
                // Get all rows of the table
                var rows = document.getElementById("myTable").querySelectorAll('table tr');
                
                // Loop through each row
                rows.forEach(function(row, index) {
                    if (index !== 0) { // Skip header row
                        // Get the value of the "ausgabe" column in the current row
                        var ausgabeColumn = row.cells[6].textContent.trim(); // Assuming the "ausgabe" column is the second column (index 1)
                        
                        // Parse the date string in the "ausgabe" column
                        var dateParts = ausgabeColumn.split(',');
                        var dateString = dateParts[0] + dateParts[1];
                        var date = new Date(dateString);
                        
                        // Check if the date parts match the current date
                        if (!isNaN(date.getTime()) && date.getFullYear() === currentYear && date.getMonth() === currentMonth && date.getDate() === currentDay) {
                            row.style.display = ''; // Show the row
                        } else {
                            row.style.display = 'none'; // Hide the row
                        }
                    }
                });
            };

           function myFunction() {
                var input, filter, table, tr, td, cell, i, j;
                input = document.getElementById("myInput");
                filter = input.value.toUpperCase();
                table = document.getElementById("myTable");
                tr = table.getElementsByTagName("tr");
                for (i = 1; i < tr.length; i++) {
                    // Hide the row initially.
                    tr[i].style.display = "none";
                    
                    td = tr[i].getElementsByTagName("td");
                    for (var j = 0; j < td.length; j++) {
                    cell = tr[i].getElementsByTagName("td")[j];
                    if (cell) {
                        if (cell.innerHTML.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                        break;
                        } 
                    }
                    }
                }
            }

            document.addEventListener('click', function (e) {
                try {
                    function findElementRecursive(element, tag) {
                        return element.nodeName === tag ? element : 
                        findElementRecursive(element.parentNode, tag)
                    }
                    var descending_th_class = ' dir-d '
                    var ascending_th_class = ' dir-u '
                    var ascending_table_sort_class = 'asc'
                    var regex_dir = / dir-(u|d) /
                    var regex_table = /\bsortable\b/
                    var alt_sort = e.shiftKey || e.altKey
                    var element = findElementRecursive(e.target, 'TH')
                    var tr = findElementRecursive(element, 'TR')
                    var table = findElementRecursive(tr, 'TABLE')
                    function reClassify(element, dir) {
                    element.className = element.className.replace(regex_dir, '') + dir
                    }
                        function getValue(element) {
                            return (
                                (alt_sort && element.getAttribute('data-sort-alt')) || 
                            element.getAttribute('data-sort') || element.innerText
                        )
                    }
                    if (regex_table.test(table.className)) {
                        var column_index
                        var nodes = tr.cells
                        for (var i = 0; i < nodes.length; i++) {
                            if (nodes[i] === element) {
                                column_index = element.getAttribute('data-sort-col') || i
                            } else {
                                reClassify(nodes[i], '')
                            }
                        }
                        var dir = descending_th_class
                        if (
                            element.className.indexOf(descending_th_class) !== -1 ||
                            (table.className.indexOf(ascending_table_sort_class) !== -1 &&
                            element.className.indexOf(ascending_th_class) == -1)
                        ) {
                            dir = ascending_th_class
                        }
                        reClassify(element, dir)
                        var org_tbody = table.tBodies[0]
                        var rows = [].slice.call(org_tbody.rows, 0)
                        var reverse = dir === ascending_th_class
                        rows.sort(function (a, b) {
                            var x = getValue((reverse ? a : b).cells[column_index])
                            var y = getValue((reverse ? b : a).cells[column_index])
                            return isNaN(x - y) ? x.localeCompare(y) : x - y
                        })
                        var clone_tbody = org_tbody.cloneNode()
                        while (rows.length) {
                            clone_tbody.appendChild(rows.splice(0, 1)[0])
                        }
                        table.replaceChild(clone_tbody, org_tbody)
                    }
                } catch (error) {
                }
            });

            c = 1;
            function addInputField() {
                var div = document.createElement("div");
                var div2 = document.createElement("div");

                // create an input field to insert
                var newInputField = document.createElement("input");
                // set input field data type to text
                newInputField.type = "text";
                // set input field name
                newInputField.name = c;
                // set required
                newInputField.placeholder = "Inventarnummer/Servicenummer";
                newInputField.style = "max-width: 96%; margin-left: 4%; margin-top: 1%;";
                newInputField.setAttribute("required", "");

                newInputField.classList.add("form-control");

                var newDeleteButton = document.createElement("button");
                newDeleteButton.type = '';
                newDeleteButton.value = "Delete";
                newDeleteButton.name = c;
                newDeleteButton.style = "float: left; padding-left: 40px; padding-top: 4px; padding-bottom: 4px; background-color: black; border: solid 1px black; margin-top: 15px; margin-left: 13px; border-radius: 2px;";
                newDeleteButton.addEventListener("click", deleteHandler);

                // insert element
                div.appendChild(newDeleteButton);
                div2.appendChild(newInputField);
                div.appendChild(div2);
                document.getElementById('inputs').appendChild(div);
                c++;
            }
            function deleteHandler() {
                var parent = this.parentElement;
                parent.parentElement.removeChild(parent);
            }
        </script>
    </body>
</html>